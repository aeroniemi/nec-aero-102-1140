#include "stdint.h"
#include <Arduino.h>
#include <string.h>
#include <Wire.h>
const int numRows = 2;
const int numCols = 7;
const int numSubAddr = 3;

struct Segment
{
    int subaddr;
    int block;
    uint8_t value;
};

class Display
{
private:
    uint8_t displayBuffer[numSubAddr][4];
    Segment segmentToByte[numRows][numCols][7] = {{{{1, 0, 0x01}, {2, 3, 0x04}}, {{1, 2, 0x80}, {1, 3, 0x01}, {1, 3, 0x02}, {1, 0, 0x04}, {1, 0, 0x02}, {1, 2, 0x40}, {1, 2, 0x20}}, {{1, 3, 0x20}, {1, 3, 0x40}, {1, 3, 0x80}, {1, 0, 0x08}, {1, 3, 0x04}, {1, 3, 0x10}, {1, 3, 0x08}}, {{2, 2, 0x80}, {2, 3, 0x01}, {2, 3, 0x02}, {1, 0, 0x10}, {2, 1, 0x01}, {2, 2, 0x40}, {2, 1, 0x02}}, {{2, 3, 0x40}, {2, 3, 0x80}, {0, 0, 0x01}, {0, 2, 0x20}, {2, 3, 0x08}, {2, 3, 0x20}, {2, 3, 0x10}}, {{0, 0, 0x10}, {0, 3, 0x04}, {0, 3, 0x08}, {0, 2, 0x40}, {0, 0, 0x02}, {0, 0, 0x08}, {0, 0, 0x04}}, {{0, 3, 0x80}, {0, 3, 0x02}, {0, 3, 0x01}, {0, 2, 0x80}, {0, 3, 0x10}, {0, 3, 0x40}, {0, 3, 0x20}}}, {{{1, 1, 0x02}, {2, 2, 0x02}}, {{1, 0, 0x80}, {1, 2, 0x04}, {1, 2, 0x08}, {1, 2, 0x10}, {1, 1, 0x04}, {1, 1, 0x01}, {1, 1, 0x08}}, {{1, 0, 0x40}, {1, 1, 0x10}, {1, 1, 0x20}, {1, 1, 0x40}, {1, 1, 0x80}, {1, 2, 0x02}, {1, 2, 0x01}}, {{1, 0, 0x20}, {2, 2, 0x04}, {2, 2, 0x08}, {2, 2, 0x10}, {2, 2, 0x20}, {2, 1, 0x08}, {2, 1, 0x04}}, {{0, 2, 0x10}, {0, 1, 0x08}, {2, 1, 0x10}, {2, 1, 0x20}, {2, 1, 0x40}, {2, 2, 0x01}, {2, 1, 0x80}}, {{0, 2, 0x08}, {0, 0, 0x20}, {0, 0, 0x40}, {0, 0, 0x80}, {0, 1, 0x01}, {0, 1, 0x04}, {0, 1, 0x02}}, {{0, 2, 0x04}, {0, 2, 0x02}, {0, 2, 0x01}, {0, 1, 0x10}, {0, 1, 0x20}, {0, 1, 0x80}, {0, 1, 0x40}}}};
    int charsToSegments[10][7] = {
        {1, 2, 3, 4, 5, 6},    // '0'
        {2, 3},                // '1'
        {1, 2, 4, 5, 7},       // '2'
        {1, 2, 3, 4, 7},       // '3'
        {2, 3, 6, 7},          // '4'
        {1, 3, 4, 6, 7},       // '5'
        {1, 3, 4, 5, 6, 7},    // '6'
        {1, 2, 3},             // '7'
        {1, 2, 3, 4, 5, 6, 7}, // '8'
        {1, 2, 3, 4, 6, 7},    // '9'
    };

public:
    Display();
    void setText(int row, String text);
    void resetDisplay();
    void setSegment(int row, int col, int ident);
    Segment getSegmentValue(int row, int col, int ident);
    void addDots();
    void update();
    void write(int subaddr);
};